<script type="text/javascript">
	/* Loading themeTester */
	//var loadingEl = dojo.byId("loaderInner");
	//loadingEl.innerHTML += "<br />* Menu widgets - dijit.Menu";
	
	selectedRoutineNames = [];

	
	dojo.ready( function() {
		/* delete cookie */
		//if (document.URL == "http://127.0.0.1:8000/index/" || document.URL == "http://127.0.0.1:8000/index/?clear="){
		//	dojo.cookie("nameList", null, {path: '/', expire: -1});
		//	console.log("initial cookie:", dojo.cookie("nameList"));
		//}
		
		
		// this is just a list of 'official' dijit themes, you can use
		// ?theme=String for 'un-supported' themes, too. (eg: yours)
		
		var availableThemes = [
			{
				theme:"1",
				author:"Sa-Lin Cheng Bernstein",
				baseUri:"../themes/"
			},
			{
				theme:"2",
				author:"Javed Hossain",
				baseUri:"../themes/"
			},
			{
				theme:"3",
				author:"Elizabeth R. Jessup",
				baseUri:"../themes/"
			},
			{
				theme:"4",
				author:"Boyana Norris",
				baseUri:"../themes/"
			}
		];
		var holder = dojo.byId('themeData');
		var tmpString='';
		dojo.forEach(availableThemes, function(theme) {
			tmpString += '<a href="?theme='+theme.theme+'">'+
			theme.theme+'</'+'a>: '+theme.author+' <br>';
		});
		holder.innerHTML = tmpString;
		
		
		
		
		/* for parser time info */
		var start = new Date().getTime();
		dojo.parser.parse(dojo.byId('container'));
		console.info("Total parse time: " + (new Date().getTime() - start) + "ms");
		
		
		
		//dojo.byId('loaderInner').innerHTML += " done.";
		
		
		
		setTimeout( function hideLoader() {
			var loader = dojo.byId('loader');
			dojo.fadeOut({
				node: loader,
				duration:100,
				onEnd: function() {
					loader.style.display = "none";
				}
			}).play();
		}, 50);
		
		
		
		var strayGlobals = [];
		for(var i in window) {
			if(!window.__globalList[i]) {
				strayGlobals.push(i);
			}
		}
		if(strayGlobals.length) {
			console.warn("Stray globals: "+strayGlobals.join(", "));
		}
		
		/* create dnd Sources */
		var source1 = new dojo.dnd.Source("routineListNode");
		var source2 = new dojo.dnd.Target("selectedListNode");		

		/* update Django session for selected routines through javascript*/
		//var nameObj = [];
		dojo.connect( source1, "onDndDrop", 
			function(source, nodes, copy, target){
				//console.log("cookie predrop:", dojo.cookie("nameList"));
				var cookieToArray = [];
				if (dojo.cookie("nameList") != null){
					cookieToArray = dojo.cookie("nameList").split(',');
				}
				
				for( i=0; i < nodes.length; i++){
					item = this.getItem(nodes[i].id);
					liId = nodes[i].id;
					//routineData = item.data;
					//nameObj.push(liId);
					//dojo.cookie(liId, routineData, {path: '/'});					
					
					var detail = dojo.attr(dojo.byId(liId), "detail")
					var precision = detail.split("_")[0];
                    var routineName = detail.split("_")[1];
                    var matrixType = detail.split("_")[2];
					var storageType = detail.split("_")[3];
					var idn = detail.split("_")[4];
					var url = detail.split("_")[5];					
					
					//dojo.cookie(liId, detail);
					
					/* pass "routineData" to ajax.py for test */
					//Dajaxice.Driver.test(Dajax.process, {'data': routineData});
					
					/* pass "detail" to views.py via ajax to update request.session['selectedRoutines'] */
					dojo.xhrPost( {
						url: "/search/update_session/",
						content: {
							precision: precision,
							routineName: routineName,
							matrixType: matrixType,
							storageType: storageType,
							idn: idn,
							url: url,
							checkState: "checked"
							},
						load: function(response){
							//response is a string --> convert into an array
							selectedRoutineNames = response.split(',');
							console.log("load response: ", selectedRoutineNames);
						    },
						error: function(){
						    console.log("error");
						    }
					});
				}
				//dojo.cookie("nameList", cookieToArray.concat(nameObj), {path: '/'});
				//console.log("cookie after drop: ", dojo.cookie("nameList"));
				//console.log("host name:", window.location.hostname);
				//console.log(location.href);
				//console.log(dojo.attr(dojo.byId(nameObj[0]), "detail"));
			}
		);

		

	});

	
	/* clear cookie */
	//function clearCookie() {
	//	dojo.cookie("nameList", null, {expire: -1});
	//}
	

	/* showing/hiding the table in the search result by clicking the image */
	function show_hide(tblid, show) {
		if (tbl == document.getElementById(tblid)) {
			if (null == show) show = tbl.style.display == 'none';
			tbl.style.display = (show ? '' : 'none');
		}
	}


	/* disable the radiobuttons in the first question when clicking a checkbox */
	function disableRadiobuttons() {
	    length = document.frmProb.length;
	    for (i=0; i<length; i++)
		{
		    if (document.frmProb[i].type == "radio")
			document.frmProb[i].disabled = "disabled";
		}
	}



	/* disable the checkboxes in the first question when clicking a radiobutton */
	function disableCheckboxes() {
	    length = document.frmProb.length;
	    for (i=0; i<length; i++)
		{
		    if (document.frmProb[i].type == "checkbox")
			document.frmProb[i].disabled = "disabled";
		}
	}


	
	/* disable THE OTHER radiobutton in the "complex numbers" question --> NOT working yet! */
	function disableComplex(dict) {
	   length = document.frmComp.length;
	   for (i=0; i<length; i++)
		{
		    if (document.frmComp[i].value != dict)
			document.frmComp[i].disabled = "disabled";
		}
	}

	
	/* Ask for confirmation when user clicks on Restart Search button */
	function show_confirm(){
		var restart = "";
		restart = confirm("Are you sure you start over the search?");
		if(restart)
			window.location = "/search/";
		else return false;		
	}


	/* Clear all routines from selected routines area */
	function clearAllRoutines(){
		//reset request.session['selectedRoutines'] = [] and empty the list			
		dojo.xhrPost( {
			url: "/search/clear_session/",
			content: {clear: "all"},
			load: function(response){
				dojo.empty("sel_routineListNode");
				dojo.empty("selectedListNode");
				console.log(response);
			    },
			error: function(){
			    console.log("error");
			    }
		});
		
		//dojo.empty("routineListNode");
	}
	
	/* Eliminate duplicated elements in arrays */
	//Array.prototype.unique = function () {
	//	var r = new Array();
	//	o:for(var i = 0; i< this.length; i++)
	//	{
	//		for(var j = 0; j< r.length; j++)
	//		{
	//			if(r[j]==this[i])
	//			{
	//				//alert(r[j] +' is a DUPE!');
	//				continue o;
	//			}
	//		}
	//		r[r.length] = this[i];
	//	}
	//	return r;
	//}

	
	// Functions for faster tooltips for submit and clear buttons
	function showTooltip(id, text, color){		
		document.getElementById(id).innerHTML=text;
		document.getElementById(id).style.color=color;
	}


	// Check radio buttons in guided search

	function checkRadios(){
		var radios = document.getElementsByTagName('input');
		var checked = false;
		for (var i = 0; i < radios.length; i++) {
		    if (radios[i].type === 'radio' && radios[i].checked) {
		        checked = true;
		    }
		}
		return checked;
	}

	

	
	
	
	
	/*--------------------------------------------------------------------------------- */	
	/* ------------------------------ For Advanced Search ----------------------------- */
	/*--------------------------------------------------------------------------------- */
	
	// Check if at least one check box (out of three in the initial advanced search tab) has been selected 
	function validateAdvancedCategoryCheckbox(chk1, chk2, chk3){
		if (!validate3Checkbox(chk1, chk2, chk3))
		{
			alert("Select at least one category.");
			return false;
		}
		else
			return true;
	}

	// Check if at least 1/2 check box is selected
	function validate1Checkbox(cb1)
	{
		if (cb1.checked == 0)
			return false;
		else
			return true;
	}

	// Check if at least 1/2 check box is selected
	function validate2Checkbox(cb1, cb2)
	{
		if (cb1.checked == 0 && cb2.checked == 0)
			return false;
		else
			return true;
	}

	// Check if at least 1/3 check box is selected
	function validate3Checkbox(cb1, cb2, cb3)
	{
		if (cb1.checked == 0 && cb2.checked == 0 && cb3.checked == 0)
			return false;
		else
			return true;
	}

	// Check if at least 1/4 check box is selected
	function validate4Checkbox(cb1, cb2, cb3, cb4)
	{
		if (cb1.checked == 0 && cb2.checked == 0 && cb3.checked == 0 && cb4.checked == 0)
			return false;
		else
			return true;
	}

	// Check if at least 1/5 check box is selected
	function validate5Checkbox(cb1, cb2, cb3, cb4, cb5)
	{
		if (cb1.checked == 0 && cb2.checked == 0 && cb3.checked == 0 && cb4.checked == 0 && cb5.checked == 0)
			return false;
		else
			return true;
	}

	// Check if at least 1/6 check box is selected
	function validate6Checkbox(cb1, cb2, cb3, cb4, cb5, cb6)
	{
		if (cb1.checked == 0 && cb2.checked == 0 && cb3.checked == 0 && cb4.checked == 0 && cb5.checked == 0 && cb6.checked == 0)
			return false;
		else
			return true;
	}

	// Check if at least 1/7 check box is selected
	function validate7Checkbox(cb1, cb2, cb3, cb4, cb5, cb6, cb7)
	{
		if (cb1.checked == 0 && cb2.checked == 0 && cb3.checked == 0 && cb4.checked == 0 && cb5.checked == 0 && cb6.checked == 0 && cb7.checked == 0)
			return false;
		else
			return true;
	}
	

	// Check if at least one check box in each cell is selected (in Computational Routine Search)
	function validateComputationalCheckbox(f1, f2, f3, f4, f5, f6, f7, c1, c2, m1, m2, m3, m4, m5, m6, s1, s2, s3, s4, p1, p2)
	{
		f = validate7Checkbox(f1, f2, f3, f4, f5, f6, f7);
		c = validate2Checkbox(c1, c2);
		m = validate6Checkbox(m1, m2, m3, m4, m5, m6);
		s = validate4Checkbox(s1, s2, s3, s4);
		p = validate2Checkbox(p1, p2);

		if(!f)
		{
			alert("Check at least one box in the Function cell in Computational Routines column.");
			return false;
		}
		else if(!c)
		{
			alert("Check at least one box in the Complex Number cell in Computational Routines column.");
			return false;
		}
		else if(!m)
		{
			alert("Check at least one box in the Matrix Type cell in Computational Routines column.");
			return false;
		}
		else if(!s)
		{
			alert("Check at least one box in the Storage cell in Computational Routines column.");
			return false;
		}
		else if(!p)
		{
			alert("Check at least one box in the Precision cell in Computational Routines column.");
			return false;
		}
		else
			return true;
					
	}

	// Check if at least one check box in each cell is selected (in Simple Driver Routine Search)
	function validateSimpleCheckbox(f1, c1, c2, m1, m2, m3, m4, m5, s1, s2, s3, s4, p1, p2)
	{
		f = validate1Checkbox(f1);
		c = validate2Checkbox(c1, c2);
		m = validate5Checkbox(m1, m2, m3, m4, m5);
		s = validate4Checkbox(s1, s2, s3, s4);
		p = validate2Checkbox(p1, p2);

		if(!f)
		{
			alert("Check at least one box in the Function cell in Simple Driver Routines column.");
			return false;
		}
		else if(!c)
		{
			alert("Check at least one box in the Complex Number cell in Simple Driver Routines column.");
			return false;
		}
		else if(!m)
		{
			alert("Check at least one box in the Matrix Type cell in Simple Driver Routines column.");
			return false;
		}
		else if(!s)
		{
			alert("Check at least one box in the Storage cell in Simple Driver Routines column.");
			return false;
		}
		else if(!p)
		{
			alert("Check at least one box in the Precision cell in Simple Driver Routines column.");
			return false;
		}
		else
			return true;			
	}

	// Check if at least one check box in each cell is selected (in Expert Driver Routine Search)
	function validateExpertCheckbox(d1, d2, d3, f1, f2, f3, f4, c1, c2, m1, m2, m3, m4, m5, s1, s2, s3, s4, p1, p2)
	{
    	d = validate3Checkbox(d1, d2, d3);
		f = validate4Checkbox(f1, f2, f3, f4);
		c = validate2Checkbox(c1, c2);
		m = validate5Checkbox(m1, m2, m3, m4, m5);
		s = validate4Checkbox(s1, s2, s3, s4);
		p = validate2Checkbox(p1, p2);

		if(!d)
		{
			alert("Select at least one Equation in the Function cell in Expert Driver Routines column.");
			return false;
		}
		else if(!f)
		{
			alert("Select at least one Task in the Function cell in Expert Driver Routines column.");
			return false;
		}
		else if(!c)
		{
			alert("Check at least one box in the Complex Number cell in Expert Driver Routines column.");
			return false;
		}
		else if(!m)
		{
			alert("Check at least one box in the Matrix Type cell in Expert Driver Routines column.");
			return false;
		}
		else if(!s)
		{
			alert("Check at least one box in the Storage cell in Expert Driver Routines column.");
			return false;
		}
		else if(!p)
		{
			alert("Check at least one box in the Precision cell in Expert Driver Routines column.");
			return false;
		}
		else
			return true;
					
	}

	// Check if at least one check box in each cell is selected (in Computational Routine and Simple Driver Routine Search)
	function validateComputationalSimpleCheckbox(cf1, cf2, cf3, cf4, cf5, cf6, cf7, cc1, cc2, cm1, cm2, cm3, cm4, cm5, cm6, cs1, cs2, cs3, cs4, cp1, cp2, sf1, sc1, sc2, sm1, sm2, sm3, sm4, sm5, ss1, ss2, ss3, ss4, sp1, sp2)
	{
		c = validateComputationalCheckbox(cf1, cf2, cf3, cf4, cf5, cf6, cf7, cc1, cc2, cm1, cm2, cm3, cm4, cm5, cm6, cs1, cs2, cs3, cs4, cp1, cp2);

		if(c == true)
		{
			s = validateSimpleCheckbox(sf1, sc1, sc2, sm1, sm2, sm3, sm4, sm5, ss1, ss2, ss3, ss4, sp1, sp2);
		}
			

		if(c && s)
			return true;
		else 
			return false;
	}

	// Check if at least one check box in each cell is selected (in Computational Routine and Expert Driver Routine Search)
	function validateComputationalExpertCheckbox(cf1, cf2, cf3, cf4, cf5, cf6, cf7, cc1, cc2, cm1, cm2, cm3, cm4, cm5, cm6, cs1, cs2, cs3, cs4, cp1, cp2, ed1, ed2, ed3, ef1, ef2, ef3, ef4, ec1, ec2, em1, em2, em3, em4, em5, es1, es2, es3, es4, ep1, ep2)
	{
		c = validateComputationalCheckbox(cf1, cf2, cf3, cf4, cf5, cf6, cf7, cc1, cc2, cm1, cm2, cm3, cm4, cm5, cm6, cs1, cs2, cs3, cs4, cp1, cp2);	

		if(c == true)
		{
			e = validateExpertCheckbox(ed1, ed2, ed3, ef1, ef2, ef3, ef4, ec1, ec2, em1, em2, em3, em4, em5, es1, es2, es3, es4, ep1, ep2);
		}
			

		if(c && e)
			return true;
		else 
			return false;
	}

	// Check if at least one check box in each cell is selected (in Simple Driver Routine and Expert Driver Routine Search)
	function validateSimpleExpertCheckbox(sf1, sc1, sc2, sm1, sm2, sm3, sm4, sm5, ss1, ss2, ss3, ss4, sp1, sp2, ed1, ed2, ed3, ef1, ef2, ef3, ef4, ec1, ec2, em1, em2, em3, em4, em5, es1, es2, es3, es4, ep1, ep2)
	{
		s = validateSimpleCheckbox(sf1, sc1, sc2, sm1, sm2, sm3, sm4, sm5, ss1, ss2, ss3, ss4, sp1, sp2);

		if(s == true)
		{
			e = validateExpertCheckbox(ed1, ed2, ed3, ef1, ef2, ef3, ef4, ec1, ec2, em1, em2, em3, em4, em5, es1, es2, es3, es4, ep1, ep2);
		}
			

		if(s && e)
			return true;
		else 
			return false;
	}

	// Check if at least one check box in each cell is selected (in Computational Routines, Simple Driver Routine and Expert Driver Routine Search)
	function validateComputationalSimpleExpertCheckbox(cf1, cf2, cf3, cf4, cf5, cf6, cf7, cc1, cc2, cm1, cm2, cm3, cm4, cm5, cm6, cs1, cs2, cs3, cs4, cp1, cp2, sf1, sc1, sc2, sm1, sm2, sm3, sm4, sm5, ss1, ss2, ss3, ss4, sp1, sp2, ed1, ed2, ed3, ef1, ef2, ef3, ef4, ec1, ec2, em1, em2, em3, em4, em5, es1, es2, es3, es4, ep1, ep2)
	{		
		c = validateComputationalCheckbox(cf1, cf2, cf3, cf4, cf5, cf6, cf7, cc1, cc2, cm1, cm2, cm3, cm4, cm5, cm6, cs1, cs2, cs3, cs4, cp1, cp2);

		if(c == true)
		{
			s = validateSimpleCheckbox(sf1, sc1, sc2, sm1, sm2, sm3, sm4, sm5, ss1, ss2, ss3, ss4, sp1, sp2);
		}

		if(s == true)
		{
			e = validateExpertCheckbox(ed1, ed2, ed3, ef1, ef2, ef3, ef4, ec1, ec2, em1, em2, em3, em4, em5, es1, es2, es3, es4, ep1, ep2);
		}

		if(c && s && e)
			return true;
		else 
			return false;
	}


	/*--------------------------------------------------------------------------------- */	
	/* ------------------------------ For Keyword Search ----------------------------- */
	/*--------------------------------------------------------------------------------- */

	// Check if any keyword was provided
	function checkKeyword(){
				
		t = document.getElementById("keyword").value;

		//alert(t);
		
		if(t.length == 0){
			alert("Please enter a keyword.");
			return false;
		}
		else{
			return true;
		}
			
	}

	//
	function catchEnter() {
		var e = window.event;
		if (e.keyCode) code = e.keyCode;
		else if (e.which) code = e.which;

		if (code==13) {
			if(checkKeyword())
				document.forms["keyword_form"].submit();
		}
	}
	
	// Trim a string
	function trim(stringToTrim) {
		return stringToTrim.replace(/^\s+|\s+$/g,"");
	}

	var code;
	var tmp = -1;
	var t = null;
	var s = null;
	var kwtbArrValue = new Array();
	var kwtbArrText = new Array();

	document.onkeydown = function(e)
	{
		if(!e) var e = window.event;
		code = e.keyCode;
		//document.getElementById("test").innerHTML = code + "|" + tmp;		

		//document.getElementById("test").innerHTML = code;
		tmp2 = document.forms['kw_form'].elements['sel'].length - 1;

		if(document.forms['kw_form'].elements['sel'].length == 0) tmp = -1;
		
		if(code >= 48 && code <= 90){
			if(window.event.shiftKey)
				org_input = document.getElementById("keyword").value + String.fromCharCode(code);
			else
				org_input = document.getElementById("keyword").value + String.fromCharCode(code).toLowerCase();
			//alert(org_input);
			//document.getElementById("test").innerHTML = org_input;
		}


		if(code==40){					
			tmp = tmp + 1;
			if(tmp > tmp2) tmp = tmp2;			
			document.forms['kw_form'].elements['sel'].options[tmp].selected = true;
			product = document.forms['kw_form'].elements['sel'].options[tmp].text;   
			document.forms['kw_form'].elements['kwtb'].value = product;									
		}
		if(code==38){
			if(tmp == 0){
				document.forms['kw_form'].elements['sel'].options[0].selected = false;				
				document.forms['kw_form'].elements['kwtb'].value = org_input;
				//document.getElementById("keyword").value = "";
				tmp = -1;				
			}
				
			if(tmp >= 1){
				tmp = tmp - 1;
				document.forms['kw_form'].elements['sel'].options[tmp].selected = true;
				product = document.forms['kw_form'].elements['sel'].options[tmp].text;   
				document.forms['kw_form'].elements['kwtb'].value = product;				
			}			
		}

		if(code==13){			
			document.getElementById("show").style.display='none';
		}	
	}	 
		
	function init()
	{
        //create a global reference to the text field
        t = document.getElementById("keyword");
        //create a global reference to the select menu
        s = document.getElementById("sel");
        //Make a copy of the data to loop through
        //and to restore the list if needed
        for(var i = 0;i < s.options.length;i++)
        {
        	kwtbArrValue[i] = s.options[i].value;
        	kwtbArrText[i] = s.options[i].text;
        }
    }

    function findIt(val,txt,menu,tfield)
    {
    	if(code==40||code==38||code==13)
    	{

    	}
    	else
    	{
    		if(tfield.value.length == 0){
			document.getElementById("show").style.display='none';
			return;
	}

	if(tfield.value.length==1)
	{
		document.getElementById("show").style.display='inline';
		var tmp = document.forms['kw_form'].elements['sel'].length;
		for(a=tmp;a>=0;a--)
		{
			document.forms['kw_form'].elements['sel'].options[a] = null;
		}
		obj = document.forms['kw_form'].elements['sel'];

		obj[0] = new Option('factor a matrix','s0000');
		obj[1] = new Option('estimate the condition number','s0001');
		obj[2] = new Option('compute forward error bounds','s0002');
		obj[3] = new Option('compute backward error bounds','s0003');
		obj[4] = new Option('refine the solution','s0004');
		obj[5] = new Option('equilibrate a matrix','s0005');
		obj[6] = new Option('invert a matrix','s0006');
		obj[7] = new Option('complex numbers','s0007');
		obj[8] = new Option('general','s0008');
		obj[9] = new Option('symmetric','s0009');
		obj[10] = new Option('SPD','s0010');
		obj[11] = new Option('Hermitian','s0011');
		obj[12] = new Option('HPD','s0012');
		obj[13] = new Option('triangular','s0013');
		obj[14] = new Option('full','s0014');
		obj[15] = new Option('band','s0015');
		obj[16] = new Option('packed','s0016');
		obj[17] = new Option('tridiagonal','s0017');
		obj[18] = new Option('single precision','s0018');
		obj[19] = new Option('double precision','s0019');


		init();
	}

	if(tfield.value.length > 0)
	{
		menu.options.length = 0;
		var reg = new RegExp("^" + tfield.value,"i");
		var op = document.createElement("option");
		var tmp = null;
		for(var i = 0;i < val.length;i++)
		{
			if(reg.test(txt[i]))
			{
				var tt = document.createTextNode(txt[i]);
				tmp = op.cloneNode(false);
				tmp.setAttribute("value",val[i]);
				tmp.appendChild(tt);
				menu.appendChild(tmp);
			}
		}
	}
	else
	{
		restore(val,txt,menu,tfield);
	}

	document.getElementById("show").style.display='inline';

	}
	}

function restore(val,txt,menu,tfield)
{
	if(tfield.value.length < 2 && menu.options.length != val.length)
	{
		menu.options.length = 0;
		var op = document.createElement("option");
		var tmp = null;
		for(var i = 0;i < val.length;i++)
		{
			var tt = document.createTextNode(txt[i]);
			tmp = op.cloneNode(false);
			tmp.setAttribute("value",val[i]);
			tmp.appendChild(tt);
			menu.appendChild(tmp);
		}
	}
}

	/*--------------------------------------------------------------------------------- */	
	/* ----------------------------- For Selected Routines ---------------------------- */
	/*--------------------------------------------------------------------------------- */

	function clearSelectedRoutines(uncheckedRoutines, selectedRoutineNames){		
		
		dojo.xhrPost( {
			url: "/search/clear_session/",
			content: {clear: "selected"},
			load: function(response){
				console.log(response);
			    },
			error: function(){
			    console.log("error");
			    }
		});

		
		var len = uncheckedRoutines.length;

		//alert(document.getElementById("ts_"+routineName.toUpperCase()).parent.toString());

		for(var i = 0; i < len; i++){
			routineName = uncheckedRoutines[i];
			ts = document.getElementById("ts_"+routineName.toUpperCase());
			td = document.getElementById("td_"+routineName.toUpperCase());
			if(ts)
				ts.style.display = "none";

			if(selectedRoutineNames.length > 0)
				if(td)
					td.style.display = "none";
		}		
	}

	function checkAllRoutines(allRoutines){
		var checkbox;
		var routineName;
		var len = allRoutines.length;

		for(var i = 0; i < len; i++){
			routineName = allRoutines[i];
			checkbox_s = document.getElementById("cbs_"+routineName.toUpperCase());
			checkbox_d = document.getElementById("cbd_"+routineName.toUpperCase());
			if(checkbox_s)
				checkbox_s.checked = 1;
			if(checkbox_d)
				checkbox_d.checked = 1;
		}
	}

	function checkChanged(routine, selectedRoutineNames, selectedRoutine_session, uncheckedRoutines, mode){

		var checkbox;
		if(mode == "droppedRoutine")
			checkbox = document.getElementById("cbd_"+routine);
		else if(mode == "selectedRoutine")
			checkbox = document.getElementById("cbs_"+routine);

		if(selectedRoutineNames.length > 0)
			selectedRoutine_session = selectedRoutineNames;

		//alert(selectedRoutine_session.toString());

		var detail = checkbox.value;
		var precision = detail.split("_")[0];
        var routineName = detail.split("_")[1];
        var matrixType = detail.split("_")[2];
		var storageType = detail.split("_")[3];
		var idn = detail.split("_")[4];
		var url = detail.split("_")[5];
		var checked;

		if(checkbox.checked == 1){
			checked = "checked";
			if(!routineExists(routine, selectedRoutine_session))
            	selectedRoutine_session.push(routine.toLowerCase());

            if(routineExists(routine, uncheckedRoutines)){
                var index = uncheckedRoutines.indexOf(routine.toLowerCase());
                uncheckedRoutines.splice(index, 1); 
            }            

		}

		else if(checkbox.checked == 0){
			checked = "unchecked";
			if(routineExists(routine, selectedRoutine_session)){
                var index = selectedRoutine_session.indexOf(routine.toLowerCase());
                selectedRoutine_session.splice(index, 1); 
            }

            if(!routineExists(routine, uncheckedRoutines))
            	uncheckedRoutines.push(routine.toLowerCase());
		}

		dojo.xhrPost( {
			url: "/search/update_session/",
			content: {
				precision: precision,
				routineName: routineName,
				matrixType: matrixType,
				storageType: storageType,
				idn: idn,
				url: url,
				checkState: checked
				},
			load: function(response){
				console.log(response);
			    },
			error: function(){
			    console.log("error");
			    }
		});
		
	}

	function routineExists(routineName, array){
        routineName = routineName.toLowerCase();
        for(var i = 0; i < array.length; i++){
            if(routineName == array[i]){
    	        return true;
            }
        }
        return false;
	}


</script>
